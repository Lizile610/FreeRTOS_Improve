# 12_使用队列的第二个好处



## 裸机程序中的做法

假设裸机程序中：

```c
void A_func(void)
{
    // ...
    
    flag = 1;  // 在某些条件下设置 flag
    
    // ,,,
}

void B_func(void)
{
    if (flag == 1)
    {
        // ...
    }
}

int main ()
{
    while (1)
    {
	    A_func();
        B_func();
    }
}
```

这样做有一个缺点：

假如主函数循环了 100 万次，`A_func` 中都没有将 `flag` 设置为 1，那么 `B_func` 也要跟着循环 100 万次，每次循环都要判断一下 `flag` 是不是 1，没有做任何有意义的事情，浪费 CPU 资源。



## 队列中的做法

```c
A_Task()
{
    while (1)
    {
        // 在某些条件下，写队列 Queue1
    }
}

B_Task()
{
    while (1)
    {
        // 读队列 Queue1
        
        // 做一些事情
    }
}
```

在读队列函数内部：

- 如果队列有数据，则返回数据
- 如果队列无数据，则休眠
  - 假如任务 B 尝试读队列时被休眠，就会被放入 `pxDelayedTaskList`
  - 一旦队列中有数据，任务 B 就会被放回 `pxReadyTasksLists`，注意，这不代表 B 会马上运行，只是 B 进入了就绪态



## 好处

在上述例子中，任务 B 没有数据可读时，将会一直休眠，不会被调度到前台占用 CPU 资源